schema_version = "2"

[service]
# At least one of service.socket.enabled or service.http.enabled must be true.

[service.socket]
enabled = true
path = "/run/build-service.sock"
group = "users"
mode = "0660"

[service.socket.auth]
# Optional: require a token even on the Unix socket.
required = false
# tokens = ["<optional token>"]

[service.http]
enabled = false
listen_addr = "0.0.0.0:8080"

[service.http.auth]
type = "bearer"
# If false, tokens are ignored and no auth is required.
required = false
# tokens = ["<secret token>"]

[service.http.tls]
enabled = false
# cert_path = "/etc/build-service/tls/server.crt"
# key_path = "/etc/build-service/tls/server.key"
# ca_path = "/etc/build-service/tls/ca.crt"

[build]
workspace_root = "/home"
# optional: run builds as this user/group (default: service process user)
# run_as_user = "build"
# run_as_group = "build"

[build.commands]
make = "/usr/bin/make"

[build.timeouts]
default_sec = 600
max_sec = 1800

[build.environment]
allow = [
    "PATH",
    "HOME",
    "USER",
    "LANG",
    "CC",
    "CXX",
    "CFLAGS",
    "CXXFLAGS",
    "LDFLAGS",
    "PKG_CONFIG_PATH",
    "MAKEFLAGS",
]

[artifacts]
storage_root = "/var/lib/build-service/artifacts"
public_base_url = "https://builds.example.com/artifacts"
# ttl_sec = 86400
# gc_interval_sec = 3600
# max_bytes = 1073741824

[[projects]]
id = "sip-stack"
type = "repo"
repo_url = "https://github.com/org/sip-stack.git"
repo_ref = "main"
repo_subdir = "./"
commands = ["make"]
artifacts = ["bin/app", "dist/*.tar.gz"]

[[projects]]
id = "nfs-tooling"
type = "path"
path_root = "/mnt/nfs/tooling"
commands = ["make", "ninja"]
artifacts = ["out/tool"]

[logging]
level = "info"
directory = "/var/log/build-service"
max_bytes = 104857600
max_files = 5
console = false
